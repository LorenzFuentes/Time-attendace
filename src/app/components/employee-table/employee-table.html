<div class="table-container">
    <div class="header-container">
        <div class="header-left">
            <h2>Employee Table</h2>
        </div>
        <div class="header-right">
            <button class="refresh-btn" (click)="refreshData()">
                <nz-icon nzType="reload" nzTheme="outline" class="reload" />
            </button>
            <button class="add-btn" (click)="addNewEmployee()">
                <nz-icon nzType="user-add" nzTheme="outline" class="add-icon" />
                Add New Employee
            </button>
        </div>
    </div>
    <nz-table #employeeTable nzBordered [nzData]="employees" nzTableLayout="fixed" [nzLoading]="isLoading">
        <thead>
            <tr>
                <th>ID</th>
                <th>First Name</th>
                <th>Middle Name</th>
                <th>Last Name</th>
                <th>Contact</th>
                <th>Department</th>
                <th>Position</th>
                <th>Username</th>
                <th>Email</th>
                <th>Password</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let employee of employeeTable.data">
                <ng-container *ngIf="!editCache[employee.id]?.edit; else editTemplate">
                    <td>{{ employee.id }}</td>
                    <td>{{ employee.firstName }}</td>
                    <td>{{ employee.middleName || '-' }}</td>
                    <td>{{ employee.lastName }}</td>
                    <td>{{ employee.contact }}</td>
                    <td>{{ employee.department }}</td>
                    <td>{{ employee.position }}</td>
                    <td>{{ employee.username }}</td>
                    <td>
                        <a [href]="'mailto:' + employee.email">{{ employee.email }}</a>
                    </td>
                    <td>••••••••</td>
                    <td>
                        <div class="btn-container">
                            <button class="edit-btn" (click)="startEdit(employee.id)">
                                Edit
                            </button>
                            <button class="delete-btn" nz-popconfirm 
                                    nzPopconfirmTitle="Delete this employee?" 
                                    (nzOnConfirm)="deleteEmployee(employee.id)">
                                Delete
                            </button>
                        </div>
                    </td>
                </ng-container>
                <ng-template #editTemplate>
                    <td>
                        <input nz-input [(ngModel)]="editCache[employee.id].data.firstName" placeholder="First Name"[class.invalid]="!editCache[employee.id].data.firstName.trim()" />
                    </td>
                    <td>
                        <input nz-input [(ngModel)]="editCache[employee.id].data.middleName" placeholder="Middle Name" />
                    </td>
                    <td>
                        <input nz-input [(ngModel)]="editCache[employee.id].data.lastName"  placeholder="Last Name" [class.invalid]="!editCache[employee.id].data.lastName.trim()" />
                    </td>
                    <td>
                        <input nz-input [(ngModel)]="editCache[employee.id].data.contact" placeholder="Contact" [class.invalid]="!editCache[employee.id].data.contact.trim()" />
                    </td>
                    <td>
                        <input nz-input [(ngModel)]="editCache[employee.id].data.department" placeholder="Department" [class.invalid]="!editCache[employee.id].data.department.trim()" />
                    </td>
                    <td>
                        <input nz-input [(ngModel)]="editCache[employee.id].data.position" placeholder="Position" [class.invalid]="!editCache[employee.id].data.position.trim()" />
                    </td>
                    <td>
                        <input nz-input [(ngModel)]="editCache[employee.id].data.username" placeholder="Username"[class.invalid]="!editCache[employee.id].data.username.trim()" />
                    </td>
                    <td>
                        <input nz-input type="email"  [(ngModel)]="editCache[employee.id].data.email" placeholder="Email" [class.invalid]="!editCache[employee.id].data.email.trim()" />
                    </td>
                    <td>
                        <!-- Fix 1: Check if it's a temporary employee -->
                        <input nz-input type="password"  
                            [(ngModel)]="editCache[employee.id].data.password"  
                            [placeholder]="employee.id.startsWith('temp_') ? 'Password' : 'Leave blank to keep current'" />
                        <!-- Fix 2: Update the condition -->
                        <small class="password-hint" *ngIf="!employee.id.startsWith('temp_')">
                            Leave blank to keep current password
                        </small>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button nz-button nzType="primary" size="small" 
                                    (click)="saveEdit(employee.id)" 
                                    [disabled]="!isFormValid(employee.id)">
                                Save
                            </button>
                            <!-- Fix 3: Update cancel button text -->
                            <button nz-button nzType="default" size="small"
                                    (click)="cancelEdit(employee.id)">
                                {{ employee.id.startsWith('temp_') ? 'Cancel Add' : 'Cancel' }}
                            </button>
                        </div>
                    </td>
                </ng-template>
            </tr>
        </tbody>
    </nz-table>
</div>