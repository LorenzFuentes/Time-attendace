<link href="https://api.fontshare.com/v2/css?f[]=synonym@400&f[]=chillax@600&display=swap" rel="stylesheet">

<div class="inner-content">
    <!-- Dashboard Stats -->
    <h1 class="dashboard-txt">Admin Dashboard</h1>
    <div class="dashboard-container">
        <div class="stat-card admin-card">
            <div class="card-icon">
                <i nz-icon nzType="user" nzTheme="outline" class="icon"></i>
            </div>
            <div class="card-content">
                <h3 class="card-title">Admins</h3>
                <p class="card-count">{{ adminCount }}</p>
                <p class="card-subtitle">Total Administrators</p>
            </div>
        </div>
        <div class="stat-card employee-card">
            <div class="card-icon">
                <i nz-icon nzType="team" nzTheme="outline" class="icon"></i>
            </div>
            <div class="card-content">
                <h3 class="card-title">Employees</h3>
                <p class="card-count">{{ employeeCount }}</p>
                <p class="card-subtitle">Total Employees</p>
            </div>
        </div>
        <div class="stat-card datetime-card">
            <div class="card-icon">
                <i nz-icon nzType="clock-circle" nzTheme="outline" class="icon"></i>
            </div>
            <div class="card-content">
                <h3 class="card-title">Current Time</h3>
                <p class="card-datetime">{{ currentDateTime }}</p>
                <p class="card-date">{{ currentDate }}</p>
            </div>
        </div>
    </div>
</div>
<div class="table-container">
    <div class="header-container">
        <div class="header-left">
            <h2>Admin Table</h2>
            <!--Search Input -->
            <nz-input-group nzSearch [nzAddOnAfter]="searchIcon">
                <input nz-input [(ngModel)]="searchValue" (input)="onSearch()"placeholder="Search"/>
                <ng-template #searchIcon>
                    <button nz-button nzType="primary" nzSearch (click)="onSearchClick()">
                        <i nz-icon nzType="search"></i>
                    </button>
                </ng-template>
            </nz-input-group>
        </div>
         <div class="header-right">
            <button class="refresh-btn" (click)="refreshData()">
                <nz-icon nzType="reload" nzTheme="outline" class="reload" />
            </button>
            <button class="addUser-btn" (click)="addNewUser()"> 
                <nz-icon nzType="user-add" nzTheme="outline" class="add-icon" />
                Add Employee
            </button>
            <button class="pdf-btn" (click)="exportTableToPDF()">
                <nz-icon nzType="file-pdf" nzTheme="outline" class="pdf-icon" />
                Export PDF
            </button>
        </div>
    </div>

    <!-- Display message when no results found -->
    <div *ngIf="filteredData.length === 0 && !isLoading" class="no-results">
        <!-- <nz-icon nzType="search" nzTheme="outline"></nz-icon> -->
        <h3 style="color: red;">No admins found</h3>
        <p *ngIf="searchValue" style="color: red;">No results for "{{ searchValue }}"</p>
        <p *ngIf="!searchValue">No admins in the system</p>
    </div>
    <!-- Table -->
    <nz-table #userTable nzBordered [nzData]="filteredData" nzTableLayout="fixed" [nzLoading]="isLoading" [nzPageSize]="10" [nzShowPagination]="true">
        <thead>
            <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Full Name</th>
                <th>Email</th>
                <th>Password</th>
                <th>Access Level</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Table data -->
            <tr *ngFor="let data of userTable.data">
                <ng-container *ngIf="!editCache[data.id]?.edit; else editTemplate">
                    <td>{{ data.id }}</td>
                    <td>{{ data.username }}</td>
                    <td>{{ data.fullname }}</td>
                    <td>
                        <a [href]="'mailto:' + data.email">{{ data.email }}</a>
                    </td>
                    <td>••••••••</td>
                    <td>
                        <nz-tag>
                            {{ getAccessLabel(data.access) }}
                        </nz-tag>
                    </td>
                    <td>
                        <button class="edit-btn" (click)="startEdit(data.id)">
                            Edit
                        </button>
                        <button class="delete-btn" nz-popconfirm nzPopconfirmTitle="Delete this user?" (nzOnConfirm)="deleteUser(data.id)">
                            Delete
                        </button>
                    </td>
                </ng-container>
                <!-- Add new admin design -->
                <ng-template #editTemplate>
                    <td>
                        {{ data.id.startsWith('temp_') ? 'New' : data.id }}
                    </td>
                    <td>
                        <input nz-input [(ngModel)]="editCache[data.id].data.username" placeholder="Username" [class.invalid]="!editCache[data.id].data.username.trim()"/>
                    </td>
                    <td>
                        <input nz-input [(ngModel)]="editCache[data.id].data.fullname" placeholder="Full Name" [class.invalid]="!editCache[data.id].data.fullname.trim()"/>
                    </td>
                    <td>
                        <input nz-input type="email" [(ngModel)]="editCache[data.id].data.email" placeholder="Email" [class.invalid]="!editCache[data.id].data.email.trim()"/>
                    </td>
                    <td>
                        <input nz-input type="password" [(ngModel)]="editCache[data.id].data.password" placeholder="Password" [class.invalid]="!editCache[data.id].data.password.trim()"/>
                    </td>
                    <td>
                        <nz-select [(ngModel)]="editCache[data.id].data.access" style="width: 100%;">
                            <nz-option nzValue="admin" nzLabel="Admin"></nz-option>
                        </nz-select>
                    </td>
                    <td>
                        <button nz-button nzType="primary" size="small" (click)="saveEdit(data.id)" [disabled]="!isFormValid(data.id)">
                            Save
                        </button>
                        <button nz-button nzType="default" size="small" (click)="cancelEdit(data.id)">
                            {{ data.id.startsWith('temp_') ? 'Cancel Add' : 'Cancel' }}
                        </button>
                    </td>
                </ng-template>
            </tr>
        </tbody>
    </nz-table>
</div>