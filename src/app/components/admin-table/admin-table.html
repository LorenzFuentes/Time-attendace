<div class="table-container">
    <div class="header-container">
      <div class="header-left">
        <h2>Admin Table</h2>
      </div>
      <div class="header-right">
        <button class="refresh-btn" (click)="refreshData()">
          <nz-icon nzType="reload" nzTheme="outline" class="reload" />
        </button>
        <button class="addUser-btn" (click)="addNewUser()">
          <nz-icon nzType="user-add" nzTheme="outline" class="add-icon" />
        Add New Admin
        </button>
      </div>
  </div>
  <nz-table #userTable nzBordered [nzData]="listOfData" nzTableLayout="fixed"[nzLoading]="isLoading">
    <thead>
      <tr>
        <th>Username</th>
        <th>Full Name</th>
        <th>Email</th>
        <th>Password</th>
        <th>Access Level</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of userTable.data">
        <ng-container *ngIf="!editCache[data.id]?.edit; else editTemplate">
          <td>{{ data.username }}</td>
          <td>{{ data.fullname }}</td>
          <td>
            <a [href]="data.email">{{ data.email }}</a>
          </td>
          <td>••••••••</td>
          <td>
            <nz-tag>
              {{ getAccessLabel(data.access) }}
            </nz-tag>
          </td>
          <td>
            <button class="edit-btn" (click)="startEdit(data.id)">
              Edit
            </button>
            <button class="delete-btn" nz-popconfirm nzPopconfirmTitle="Delete this user?"(nzOnConfirm)="deleteUser(data.id)">
              Delete
            </button>
          </td>
        </ng-container>
        <ng-template #editTemplate>
          <td>
            <input nz-input [(ngModel)]="editCache[data.id].data.username" placeholder="Username"[class.invalid]="!editCache[data.id].data.username.trim()"/>
          </td>
          <td>
            <input nz-input [(ngModel)]="editCache[data.id].data.fullname" placeholder="Full Name"[class.invalid]="!editCache[data.id].data.fullname.trim()"/>
          </td>
          <td>
            <input nz-input type="email"[(ngModel)]="editCache[data.id].data.email" placeholder="Email"[class.invalid]="!editCache[data.id].data.email.trim()"/>
          </td>
          <td>
            <input nz-input type="password"[(ngModel)]="editCache[data.id].data.password" placeholder="Password"[class.invalid]="!editCache[data.id].data.password.trim()"/>
          </td>
          <td>
            <nz-select [(ngModel)]="editCache[data.id].data.access"style="width: 100%;">
              <nz-option nzValue="admin" nzLabel="Admin"></nz-option>
            </nz-select>
          </td>
          <td>
            <button nz-button nzType="primary" size="small"(click)="saveEdit(data.id)"[disabled]="!isFormValid(data.id)">
              Save
            </button>
            <button nz-button nzType="default" size="small"(click)="cancelEdit(data.id)">
              {{ data.id.startsWith('temp_') ? 'Cancel Add' : 'Cancel' }}
            </button>
          </td>
        </ng-template>
      </tr>
    </tbody>
  </nz-table>
</div>